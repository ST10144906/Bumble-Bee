@model BumbleBeeWebApp.Controllers.PaymentViewModel

<link rel="stylesheet" type="text/css" href="~/css/payment.css" />

<div class="container">
    <div class="payment-header text-center">
        <h2>Make a Payment</h2>
    </div>

    <div class="payment-container">
        <form id="paymentForm">
            <div class="form-group">
                <label for="email-address">Email</label>
                <input type="email" id="email-address" class="form-control" value="@Model.Email" required />
            </div>

            <div class="form-group">
                <label for="amount">Amount</label>
                <input type="number" id="amount" class="form-control" value="@Model.Amount" required />
            </div>

            <div class="form-group">
                <label for="first-name">Name</label>
                <input type="text" id="first-name" class="form-control" value="@Model.Name" required />
            </div>

            <!-- Recurring payment option -->
            <div class="form-group">
                <label>Payment Type</label>
                <div>
                    <label><input type="radio" name="paymentType" value="one-time" checked /> One-Time Payment</label>
                </div>
                <div>
                    <label><input type="radio" name="paymentType" value="recurring" /> Recurring Donation of R100/month</label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Pay Now</button>
        </form>
    </div>

    <!-- Modals for Payment Success and Failure (same as before) -->

</div>

<!-- Paystack SDK and JavaScript (with modifications) -->
<script>
    const paymentForm = document.getElementById('paymentForm');
    paymentForm.addEventListener("submit", payWithPaystack, false);

    function payWithPaystack(e) {
        e.preventDefault();
        const paymentType = document.querySelector('input[name="paymentType"]:checked').value;
        let amount = document.getElementById('amount').value * 100;
        if (paymentType === 'recurring') {
            amount = 100 * 100; // Override with the plan's amount (in kobo)
        }
        
        let handler = PaystackPop.setup({
            key: '@Model.PublicKey', // Paystack public key
            email: document.getElementById('email-address').value,
            amount: amount, // Amount in kobo
            currency: 'ZAR',
            first_name: document.getElementById('first-name').value,
            callback: function (response) {
                if (paymentType === 'recurring') {
                    // Redirect to server-side for recurring payment
                    window.location.href = '/Payment/Subscribe?reference=' + response.reference;
                } else {
                    // One-time payment
                    window.location.href = '/Payment/VerifyPayment?reference=' + response.reference;
                }
            },
            onClose: function () {
                alert('Transaction was not completed, window closed.');
            }
        });
        handler.openIframe();
    }
</script>

<script src="https://js.paystack.co/v1/inline.js"></script>
